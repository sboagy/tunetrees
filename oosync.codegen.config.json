{
  "outputs": {
    "sqliteSchemaFile": "drizzle/schema-sqlite.generated.ts",
    "tableMetaFile": "shared/generated/sync/table-meta.generated.ts",
    "appTableMetaFile": "shared/table-meta.ts",
    "workerPgSchemaFile": "worker/src/generated/schema-postgres.generated.ts",
    "workerConfigFile": "worker/src/generated/worker-config.generated.ts"
  },
  "tableMeta": {
    "excludeTables": ["sync_change_log"],
    "changeCategoryByTable": {
      "genre": "catalog",
      "tune_type": "catalog",
      "genre_tune_type": "catalog",
      "user_profile": "user",
      "instrument": "catalog",
      "prefs_scheduling_options": "user",
      "prefs_spaced_repetition": "user",
      "user_genre_selection": "user",
      "repertoire": "repertoire",
      "table_state": null,
      "tab_group_main_state": null,
      "tune": "catalog",
      "repertoire_tune": "repertoire",
      "practice_record": "practice",
      "daily_practice_queue": "practice",
      "table_transient_data": "practice",
      "note": "repertoire",
      "reference": "repertoire",
      "tag": "repertoire",
      "tune_override": "repertoire",
      "plugin": "user"
    },
    "tableToSchemaKeyOverrides": {
      "plugin": "plugin"
    },
    "normalizeDatetimeByTable": {
      "practice_record": ["practiced", "backup_practiced", "due"],
      "daily_practice_queue": [
        "window_start_utc",
        "window_end_utc",
        "generated_at",
        "completed_at",
        "snapshot_coalesced_ts"
      ]
    }
  },
  "worker": {
    "config": {
      "collections": {
        "userProfileIds": {
          "table": "user_profile",
          "idColumn": "id",
          "ownerColumn": "id"
        },
        "selectedGenres": {
          "table": "user_genre_selection",
          "idColumn": "genre_id",
          "ownerColumn": "user_id"
        }
      },
      "pull": {
        "tableRules": {
          "plugin": {
            "kind": "orEqUserIdOrTrue",
            "column": "user_ref",
            "orColumn": "is_public"
          },
          "tune": {
            "kind": "compound",
            "operator": "or",
            "rules": [
              {
                "kind": "compound",
                "operator": "and",
                "rules": [
                  {
                    "kind": "inCollection",
                    "column": "genre",
                    "collection": "selectedGenres"
                  },
                  {
                    "kind": "publicOnly",
                    "column": "private_for"
                  }
                ]
              },
              {
                "kind": "eqUserId",
                "column": "private_for"
              }
            ]
          },
          "note": {
            "kind": "rpc",
            "functionName": "sync_get_user_notes",
            "paramMap": {
              "p_user_id": { "source": "authUserId" },
              "p_genre_ids": {
                "source": "collection",
                "collection": "selectedGenres"
              },
              "p_after_timestamp": { "source": "lastSyncAt" },
              "p_limit": { "source": "pageLimit" },
              "p_offset": { "source": "pageOffset" }
            }
          },
          "reference": {
            "kind": "rpc",
            "functionName": "sync_get_user_references",
            "paramMap": {
              "p_user_id": { "source": "authUserId" },
              "p_genre_ids": {
                "source": "collection",
                "collection": "selectedGenres"
              },
              "p_after_timestamp": { "source": "lastSyncAt" },
              "p_limit": { "source": "pageLimit" },
              "p_offset": { "source": "pageOffset" }
            }
          },
          "user_profile": {
            "kind": "eqUserId",
            "column": "id"
          }
        }
      },
      "push": {
        "tableRules": {
          "user_profile": {
            "bindAuthUserIdProps": ["id"],
            "upsert": {
              "omitSetProps": ["id"]
            }
          },
          "user_genre_selection": {
            "denyDelete": false
          },
          "table_transient_data": {
            "denyDelete": false
          },
          "practice_record": {
            "denyDelete": true,
            "upsert": {
              "omitSetProps": ["id"],
              "retryMinimalPayloadKeepProps": [
                "id",
                "repertoireRef",
                "tuneRef",
                "practiced",
                "quality",
                "due",
                "backupPracticed",
                "goal",
                "technique",
                "syncVersion",
                "lastModifiedAt",
                "deviceId"
              ]
            },
            "sanitize": {
              "ensureSyncProps": true,
              "nullIfEmptyStringProps": [
                "practiced",
                "due",
                "backupPracticed",
                "deviceId"
              ]
            }
          }
        }
      }
    }
  }
}
